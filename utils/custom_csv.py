# utils/custom_csv.py

# üìà –ó–∞–≥—Ä—É–∑—á–∏–∫ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (CSV) üìà
#
# –≠—Ç–æ—Ç –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —è–≤–ª—è–µ—Ç—Å—è "–ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–æ–º" –¥–ª—è —Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–π —É—á–∏—Ç –µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
# —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ —Ü–µ–Ω–∞–º–∏ (CSV). –û–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö,
# –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Å–æ–±–∞—è –∑–∞–ø–∏—Å—å –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏, –∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è –∫–æ–ª–æ–Ω–æ–∫ ‚Äî —Ç–∞–±—É–ª—è—Ü–∏—è.
#
# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
# - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è CSV-—Ñ–∞–π–ª–æ–≤ —Å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.
# - –£–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∞–Ω—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ "–î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú".
# - –°–æ–æ–±—â–∞–µ—Ç —Å–∏—Å—Ç–µ–º–µ, —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ñ–∞–π–ª–µ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã —Å–∏–º–≤–æ–ª–æ–º —Ç–∞–±—É–ª—è—Ü–∏–∏, –∞ –Ω–µ –∑–∞–ø—è—Ç–æ–π.
# - –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ —Ñ–∞–π–ª–∞ (—Ü–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è, –∑–∞–∫—Ä—ã—Ç–∏—è, –º–∞–∫—Å–∏–º—É–º, –º–∏–Ω–∏–º—É–º, –æ–±—ä–µ–º) —Å —Ç–µ–º–∏, —á—Ç–æ –æ–∂–∏–¥–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞.
# - –ü–æ–∑–≤–æ–ª—è–µ—Ç –≥–ª–∞–≤–Ω–æ–º—É —Å–∫—Ä–∏–ø—Ç—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
#
# –ê–≤—Ç–æ—Ä: –ú–∏—Ö–∞–∏–ª –®–∞—Ä–¥–∏–Ω https://shardin.name/
# –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 10.08.2025
# –í–µ—Ä—Å–∏—è: 1.0
# –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –≤—Å–µ–≥–¥–∞ –∑–¥–µ—Å—å: https://github.com/empenoso/backtrader-quickstart-template/
#
# –≠—Ç–æ—Ç —Ñ–∞–π–ª –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
#

import backtrader as bt

class CustomCSVData(bt.feeds.GenericCSVData):
    """
    –ö–ª–∞—Å—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV –≤ –∫–∞—Å—Ç–æ–º–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.
    –§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã: –î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú
    –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å: –¢–∞–±—É–ª—è—Ü–∏—è (\t)
    """
    params = (
        # --- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–î–ï–°–¨ ---
        ('separator', '\t'),  # –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å - —ç—Ç–æ —Ç–∞–±—É–ª—è—Ü–∏—è

        ('dtformat', '%d.%m.%Y %H:%M'),
        ('datetime', 0),
        ('open', 1),
        ('high', 2),
        ('low', 3),
        ('close', 4),
        ('volume', 5),
        ('openinterest', -1), # -1 –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –Ω–µ—Ç
        ('time', -1), # –í–∞–∂–Ω–æ, –µ—Å–ª–∏ –≤—Ä–µ–º—è —É–∂–µ –≤–∫–ª—é—á–µ–Ω–æ –≤ datetime
    )